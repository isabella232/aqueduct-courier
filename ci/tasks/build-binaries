#!/usr/bin/env bash

set -euo pipefail

GOPATH=${PWD}/go
GOARCH=amd64

go version

GO_FLAGS="-ldflags '-X github.com/pivotal-cf/aqueduct-courier/cmd.dataLoaderURL=$DATA_LOADER_URL'"

go build -o "aqueduct-linux-$GOARCH" "$GO_FLAGS" github.com/pivotal-cf/aqueduct-courier
GOOS=darwin go build -o "aqueduct-darwin-$GOARCH" "$GO_FLAGS" github.com/pivotal-cf/aqueduct-courier
GOOS=windows go build -o "aqueduct-windows-$GOARCH.exe" "$GO_FLAGS" github.com/pivotal-cf/aqueduct-courier

mkdir output-binaries
tar czvf aqueduct-binaries/aqueduct-courier-staging.tgz \
    "aqueduct-linux-$GOARCH" \
    "aqueduct-darwin-$GOARCH" \
    "aqueduct-windows-$GOARCH.exe"
